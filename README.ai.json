{
  "schema_version": "1.0",
  "metadata": {
    "name": "GenerateNoteImageFromComfyUI",
    "version": "1.0.0",
    "description": "Generate images from article text using ComfyUI and ollama",
    "license": "MIT",
    "languages": ["Python"],
    "created_at": "2024-03-15",
    "updated_at": "2024-03-15",
    "keywords": [
      "image-generation",
      "text-to-image",
      "comfyui",
      "ollama",
      "ai",
      "markdown"
    ]
  },
  "requirements": {
    "runtime": {
      "python": ">=3.8",
      "os": ["Windows", "Linux", "MacOS"]
    },
    "external_services": [
      {
        "name": "ComfyUI",
        "type": "service",
        "url": "http://127.0.0.1:8188",
        "status": "required",
        "description": "Must be running before execution"
      },
      {
        "name": "ollama",
        "type": "service",
        "url": "http://127.0.0.1:11434",
        "status": "required",
        "description": "Will be auto-started if not running"
      }
    ],
    "dependencies": {
      "python_packages": [
        {
          "name": "requests",
          "version": ">=2.31.0",
          "purpose": "HTTP communication with ComfyUI API"
        },
        {
          "name": "ollama",
          "version": ">=0.1.6",
          "purpose": "Communication with ollama service"
        },
        {
          "name": "pillow",
          "version": ">=10.2.0",
          "purpose": "Image processing operations"
        },
        {
          "name": "python-dotenv",
          "version": ">=1.0.0",
          "purpose": "Environment variable management"
        }
      ]
    }
  },
  "api": {
    "command_line": {
      "program": "article_to_image.py",
      "arguments": [
        {
          "name": "article",
          "type": "string",
          "required": true,
          "description": "Path to Markdown article file",
          "format": "file_path"
        },
        {
          "name": "prompt",
          "type": "string",
          "required": true,
          "description": "Fixed prompt template with {content} placeholder",
          "format": "text"
        },
        {
          "name": "workflow",
          "type": "string",
          "required": true,
          "description": "Path to ComfyUI workflow JSON file",
          "format": "file_path"
        },
        {
          "name": "comfyui-url",
          "type": "string",
          "required": false,
          "default": "http://127.0.0.1:8188",
          "description": "ComfyUI API URL",
          "format": "url"
        },
        {
          "name": "clear-cache",
          "type": "boolean",
          "required": false,
          "default": false,
          "description": "Clear ComfyUI cache after execution"
        },
        {
          "name": "ollama-model",
          "type": "string",
          "required": false,
          "default": "gemma3:4b",
          "description": "Ollama model name",
          "enum": [
            "gemma3:1b",
            "gemma3:4b",
            "gemma3:12b",
            "gemma3:27b"
          ]
        }
      ]
    }
  },
  "workflow": {
    "steps": [
      {
        "order": 1,
        "name": "read_article",
        "description": "Read Markdown article file",
        "input": "file_path",
        "output": "text"
      },
      {
        "order": 2,
        "name": "generate_prompt",
        "description": "Generate image prompt using ollama",
        "input": "article_text",
        "output": "generated_prompt"
      },
      {
        "order": 3,
        "name": "create_final_prompt",
        "description": "Combine fixed and generated prompts",
        "input": ["fixed_prompt", "generated_prompt"],
        "output": "final_prompt"
      },
      {
        "order": 4,
        "name": "generate_image",
        "description": "Generate image using ComfyUI",
        "input": ["workflow_data", "final_prompt"],
        "output": "image_name"
      },
      {
        "order": 5,
        "name": "save_image",
        "description": "Save image in WebP format",
        "input": ["image_name", "article_path"],
        "output": "output_path"
      }
    ]
  },
  "output": {
    "file": {
      "format": "webp",
      "naming": "{article_filename}.webp",
      "location": "same as input article"
    }
  },
  "error_handling": {
    "strategy": "fail_fast",
    "error_types": [
      {
        "type": "FileNotFoundError",
        "scope": ["article", "workflow"],
        "action": "terminate"
      },
      {
        "type": "ConnectionError",
        "scope": ["ComfyUI", "ollama"],
        "action": "terminate"
      },
      {
        "type": "RuntimeError",
        "scope": ["image_generation", "prompt_generation"],
        "action": "terminate"
      }
    ]
  },
  "resources": {
    "vram_requirements": {
      "models": [
        {
          "name": "gemma3:1b",
          "vram": "815MB",
          "performance": "lightweight"
        },
        {
          "name": "gemma3:4b",
          "vram": "3.3GB",
          "performance": "balanced"
        },
        {
          "name": "gemma3:12b",
          "vram": "8.1GB",
          "performance": "high_quality"
        },
        {
          "name": "gemma3:27b",
          "vram": "17GB",
          "performance": "best_quality"
        }
      ],
      "comfyui": {
        "base": "4GB",
        "note": "Varies based on workflow and model selection"
      }
    }
  }
} 